<!DOCTYPE html>
<html>
<body>
    <!-- 仅一个按钮，无任何多余样式 -->
    <button onclick="callTronLink()">唤起钱包并打开DApp</button>

    <script>
        // 你的DApp地址（公网HTTPS/本地局域网IP）
        const DAPP_URL = "http://192.168.1.100:8080/your-dapp.html"; 
        // 目标转账地址（示例）
        const TARGET_ADDRESS = "TENBpGLoxcAsUQvUrN36xpDKPYmadpc1x3";

        // 环节1：唤起钱包APP（核心）
        function callTronLink() {
            // 编码DApp地址
            const encodedUrl = encodeURIComponent(DAPP_URL);
            // 优先用新版Scheme
            const deepLink = `tron://open?type=dapp&url=${encodedUrl}`;
            // 跳转链接唤起钱包
            window.location.href = deepLink;
            // 唤起失败则提示手动打开
            setTimeout(() => alert("唤起失败，请手动打开钱包DApp浏览器访问：" + DAPP_URL), 2000);
        }

        // 环节2：DApp浏览器内的核心交互（示例：转账1TRX）
        async function transfer1TRX() {
            // 钱包已注入tronWeb则直接用
            if (!window.tronWeb) return alert("请在钱包DApp浏览器中打开");
            try {
                // 1. 获取地址（无需授权，波宝Pro/主流钱包通用）
                const address = window.tronWeb.defaultAddress.base58;
                // 2. 校验网络（Nile测试网=4）
                const chainId = String(await window.tronWeb.trx.getChainId());
                if (chainId !== "4") return alert("请切换到Nile测试网");
                // 3. 转账1TRX（核心）
                const amountInSun = window.tronWeb.toSun(1);
                const tx = await window.tronWeb.trx.sendTransaction(TARGET_ADDRESS, amountInSun);
                alert("转账成功，哈希：" + tx.txid);
            } catch (e) {
                alert("失败：" + e.message);
            }
        }
    </script>
</body>
</html>
